# 全球联网排行榜功能使用指南

## 📋 功能概述

本项目现已支持全球联网排行榜功能！玩家可以将自己的通关记录上传到全球排行榜，与其他玩家比拼通关时间。

## 🎯 主要特性

### 1. 双排行榜系统
- **本地排行榜（部门记录）**：保存在浏览器本地，不需要网络，可以记录所有通关记录
- **联网排行榜（都市广播）**：托管在 GitHub，全球玩家共享，按罪人和人格分组显示

### 2. 智能上传机制
- ✅ 自动检测当前选中的罪人和人格
- ✅ 验证通关时间（必须 ≥ 1小时）
- ✅ 支持添加备注说明
- ✅ 通过 GitHub Issue 系统提交数据

### 3. 数据聚合与展示
- 📊 按12个罪人分组
- 🎭 每个罪人下按人格进一步分组
- ⏱️ 每组按通关时间从快到慢排序
- 🔄 每天自动更新一次数据

## 🚀 如何使用

### 步骤 1：完成游戏并计时

1. 在主页面点击"开始筛选"按钮，随机选择罪人和人格
2. 点击"单通时间计时"按钮，打开计时器
3. 点击"开始"按钮开始计时
4. 完成游戏后点击"暂停"

### 步骤 2：保存到本地（可选）

1. 在计时器弹窗中填写备注（可选）
2. 点击"保存到本地"按钮
3. 记录将保存到浏览器的本地存储

### 步骤 3：上传到全球排行榜

#### 前置条件：
- ✅ 通关时间必须 ≥ 2小时（7200秒）
- ✅ 必须已经选择了罪人和人格
- ✅ 需要有 GitHub 账号

#### 操作步骤：
1. 点击"上传全球榜"按钮
2. 系统会自动检测：
   - 如果未选择罪人/人格，会提示先进行抽取
   - 如果时间不足1小时，会提示无法上传
3. 确认上传信息后，点击"确定"
4. 系统会在新窗口打开 GitHub Issue 提交页面
5. 在 GitHub 页面填写表单（已自动填充大部分信息）
6. 点击"Submit new issue"提交

### 步骤 4：查看排行榜

1. 点击主页面左上角的"排行榜"按钮
2. 选择标签页：
   - "部门记录（本地）"：查看自己的所有记录
   - "都市广播（联网）"：查看全球玩家的记录
3. 联网排行榜会按罪人和人格分组显示，方便查找

## 📝 GitHub Issue 模板说明

提交通关记录时，系统会自动填充以下字段：

| 字段 | 说明 | 示例 |
|------|------|------|
| 罪人ID | 罪人的编号（1-12） | 9 |
| 罪人名称 | 罪人的中文名称 | 罗佳 (Rodion) |
| 人格名称 | 人格的完整名称 | 脑叶公司E.G.O:泪锋之剑 |
| 通关时间（秒） | 总时间（秒） | 7500 |
| 通关日期 | 完成日期（YYYY-MM-DD） | 2025-12-12 |
| 是否使用了 E.G.O | 通关过程中是否使用 E.G.O | 是/否 |
| 备注（可选） | 额外说明 | 首次通关 |

## 🔧 技术实现

### 前端
- 原生 JavaScript (ES6+) 实现
- 本地数据使用 localStorage
- 联网数据通过 AJAX 从 JSON 文件读取
- 双标签页设计（本地/联网切换）

### 后端（GitHub Actions）
- **数据存储**：`data/global-ranking.json`
- **数据来源**：GitHub Issues（标签：通关记录）
- **自动聚合**：每天凌晨4点（UTC）自动运行
- **手动触发**：支持在 Actions 页面手动运行
- **数据验证**：
  - 时间必须 ≥ 7200秒
  - 罪人ID必须在1-12之间
  - 自动去重（相同时间+日期的记录）

### 数据结构

```json
{
  "version": "1.0.0",
  "generatedAt": "2025-12-12T12:00:00Z",
  "lastUpdate": "2025-12-12T12:00:00Z",
  "sinners": {
    "9": {
      "id": 9,
      "name": "罗佳 (Rodion)",
      "personas": {
        "脑叶公司E.G.O:泪锋之剑": [
          {
            "clearTime": 3765,
            "runDate": "2025-12-12",
            "comment": "首次通关",
            "submittedAt": "2025-12-12T10:30:00Z",
            "issueNumber": 123
          }
        ]
      }
    }
  }
}
```

## ❓ 常见问题

### Q1：为什么我的记录没有显示在全球排行榜？
A：请检查以下几点：
1. 您是否已经提交了 GitHub Issue？
2. Issue 是否被管理员审核通过（打上"已审核"或"已处理"标签）？
3. 审核通过后，请等待约 3-5 分钟让系统完成数据更新
4. 刷新页面并重新查看"都市广播（联网）"标签页

### Q2：我没有 GitHub 账号怎么办？
A：您仍然可以使用本地排行榜功能。如果想参与全球排行榜，请：
1. 前往 [GitHub](https://github.com) 注册免费账号
2. 验证邮箱后即可使用

### Q3：为什么必须 ≥ 2小时才能上传？
A：为了保证排行榜的质量和防止刷榜，我们设置了最低时间门槛。2小时（7200秒）是一个合理的单通游戏时长。

### Q4：我可以上传多条记录吗？
A：可以！每次通关都可以提交新记录，系统会自动汇总并按时间排序。

### Q5：如何删除错误提交的记录？
A：请在对应的 GitHub Issue 下留言，说明需要删除的原因，管理员会处理。

### Q6：联网排行榜多久更新一次？
A：
- **近实时更新**：管理员审核通过后（添加"已审核"标签），约 3-5 分钟内更新
- 自动更新：每天凌晨4点（UTC，北京时间中午12点）定时聚合
- 手动更新：管理员可以在 GitHub Actions 页面手动触发

### Q7：什么是"已审核"标签？
A：为了保证排行榜数据质量，引入了管理员审核机制：
1. 用户提交 Issue 后，会自动打上"通关记录"和"待处理"标签
2. 管理员审核 Issue 内容，确认数据真实有效
3. 管理员添加"已审核"标签，触发近实时数据更新
4. 系统处理完成后，自动将"已审核"改为"已处理"

## 🎮 最佳实践

1. **准确选择**：确保在抽取界面正确选择了罪人和人格
2. **及时保存**：完成游戏后尽快保存记录，避免数据丢失
3. **双重保存**：建议同时保存到本地和全球榜
4. **有意义的备注**：添加备注可以帮助您回忆当时的策略或条件

## 📞 反馈与支持

如有问题或建议，请通过以下方式反馈：
- GitHub Issues：在仓库提交 Issue
- QQ群：313198040

---

**祝您游戏愉快，创造佳绩！** 🎉
