---
trigger: manual
---

# 代码修改规则

## 核心原则
1. **保守修改**: 不随意修改正常运行的代码
2. **CSS保护**: 未经明确要求，不修改任何CSS样式
3. **功能优先**: 只在必要时进行代码重构或优化

## 具体规则

### 代码修改
- ✅ 只修改与当前任务直接相关的代码
- ✅ 保持现有代码的结构和风格
- ✅ 如果代码正常工作，不进行"优化"
- ❌ 不进行未经请求的重构
- ❌ 不添加未经请求的新功能

### CSS样式
- ✅ 只在用户明确要求时修改CSS
- ✅ 修改CSS时说明修改原因
- ❌ 不自动"美化"或"优化"样式
- ❌ 不修改布局、颜色、间距等视觉效果（除非被要求）

### 调试和修复
- ✅ 专注于解决报告的具体问题
- ✅ 最小化改动范围
- ✅ 保持原有代码逻辑
- ❌ 不"顺便"修改其他部分

## 响应格式
在修改代码前，简要说明：
1. 将要修改什么
2. 为什么需要修改
3. 修改范围（仅影响XX部分）


## Bug修复原则

### 修复前分析
- ✅ 完整理解bug的根本原因
- ✅ 评估修复方案对其他部分的影响
- ✅ 确认修复不会引入新问题
- ❌ 不急于修改，先充分分析

### 修复策略
- ✅ 使用最小改动原则
- ✅ 优先使用防御性编程（添加校验、边界检查）
- ✅ 保持代码的向后兼容性
- ✅ 修复后进行充分测试验证
- ❌ 不进行大规模重写
- ❌ 不引入新的依赖或复杂逻辑

### 风险控制
1. **修改前**：
   - 记录当前行为
   - 明确期望行为
   - 识别潜在副作用

2. **修改时**：
   - 只改变必要的部分
   - 添加必要的错误处理
   - 保留原有的边界条件处理

3. **修改后**：
   - 验证bug已修复
   - 确认没有破坏现有功能
   - 检查边界情况和异常场景

### 常见陷阱避免
- ❌ 修复一个bug时引入空指针问题
- ❌ 修改逻辑时忽略异步处理
- ❌ 添加新判断时忘记处理所有分支
- ❌ 修改数据结构时未考虑现有依赖
- ❌ 改变函数签名影响调用方

## 修复确认清单
- [ ] bug根因已明确
- [ ] 修复方案已验证
- [ ] 不影响其他功能
- [ ] 已添加必要的错误处理
- [ ] 已考虑边界情况
- [ ] 修复后已测试
