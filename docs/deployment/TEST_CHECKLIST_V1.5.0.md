## Task 12: 完整功能测试清单

### 概述

此清单用于验证重构后的应用在所有场景中的功能正确性。**没有功能变化，仅是代码重构** - 所有行为应与原始版本相同。

**测试方法：**
1. 在本地开发服务器上运行应用
2. 按照每个测试场景执行
3. 标记每个测试的通过/失败状态
4. 记录任何不符合预期的行为

**测试环境：**
- 浏览器: Chrome 90+, Firefox 88+, Safari 14+
- 服务器: Python `http.server` 或 Node.js `http-server`
- 网络: 有网络连接（用于GitHub集成测试）

---

## 1. 应用启动和初始化

### 1.1 页面加载
- [ ] 访问 `index.html` 时应用正常加载
- [ ] 控制台没有错误信息
- [ ] 所有核心服务（AppState, EventBus, Logger）都已初始化
- [ ] 页面显示主选择器界面

**验证方法：**
```javascript
// 在浏览器控制台中
console.log(window.appState)        // 应该存在
console.log(window.eventBus)        // 应该存在
console.log(window.logger)          // 应该存在
console.log(window.controllers)     // 应该存在
```

### 1.2 初始状态
- [ ] 罪人列表显示所有12个罪人
- [ ] 人格列表显示"请先选择罪人"
- [ ] 没有选中任何罪人或人格
- [ ] 计时器显示 `00:00:00`
- [ ] 计时器处于停止状态

### 1.3 DOM元素
- [ ] 所有必需的DOM元素都存在
- [ ] 所有按钮都可点击
- [ ] 所有输入框都可交互

---

## 2. 罪人选择功能

### 2.1 滚动选择
- [ ] 点击"罪人开始"按钮，列表开始滚动
- [ ] 罪人列表以恒定速度循环滚动
- [ ] 点击"罪人停止"按钮，列表停止
- [ ] 停止时，某个罪人被高亮显示

**预期行为：**
- 滚动速度一致（~5个/秒）
- 停止时选择的罪人名称显示在上方
- 选择的罪人头像显示出来

### 2.2 单罪人选择（Edge Case）
- [ ] 在设置中取消所有罪人的选择（除1个）
- [ ] 应用筛选
- [ ] 罪人列表只显示该罪人
- [ ] 滚动时只循环该罪人
- [ ] **无闪烁或视觉错误**（关键：highlightSelectedItem bug修复）

**测试步骤：**
1. 进入设置页面
2. 取消选择11个罪人
3. 点击"应用筛选"
4. 回到主页面
5. 点击"罪人开始"
6. 观察列表 - 应该显示该罪人
7. 点击"罪人停止"
8. 验证没有闪烁或不当的列表变化

### 2.3 多罪人选择
- [ ] 在设置中选择3-4个罪人
- [ ] 应用筛选
- [ ] 罪人列表更新为仅显示选中的罪人
- [ ] 滚动时在选中的罪人中循环

---

## 3. 人格选择功能

### 3.1 人格依赖
- [ ] 选择罪人后，人格列表更新为该罪人的人格
- [ ] 人格列表显示正确的人格名称
- [ ] 人格头像正确加载

**验证步骤：**
1. 选择"唐吉诃德"（Don Quixote）
2. 人格列表应显示：Peccatia, Superbia, Ira（或对应的中文名）
3. 每个人格的头像应正确显示

### 3.2 人格滚动和选择
- [ ] 点击"人格开始"按钮，列表开始滚动
- [ ] 人格列表在选中罪人的人格中循环
- [ ] 点击"人格停止"按钮，列表停止
- [ ] 停止时显示选中的人格名称和头像

### 3.3 人格筛选
- [ ] 进入设置页面
- [ ] 为某个罪人取消选择某些人格
- [ ] 应用筛选
- [ ] 滚动时仅循环已选中的人格

---

## 4. 筛选功能

### 4.1 罪人筛选
- [ ] "全选"按钮选择所有罪人
- [ ] "取消全选"按钮取消选择所有罪人
- [ ] "反选"按钮反转选择状态
- [ ] 应用筛选后列表正确更新
- [ ] 筛选设置保存到localStorage

**验证localStorage：**
```javascript
// 在浏览器控制台中
JSON.parse(localStorage.getItem('filter_sinners'))  // 应该包含罪人ID
```

### 4.2 人格筛选
- [ ] 进入设置页面，为不同罪人显示不同的人格
- [ ] 选择/取消选择人格复选框
- [ ] "全选人格"、"取消选择人格"、"反选人格"按钮工作正常
- [ ] 应用筛选后滚动仅显示选中的人格

### 4.3 筛选保留
- [ ] 应用筛选后刷新页面 (`F5`)
- [ ] 筛选设置应该保持
- [ ] 罪人和人格列表仍然反映之前的筛选

---

## 5. 计时器功能

### 5.1 基础计时器操作
- [ ] 点击"启动"按钮，计时器开始计时
- [ ] 计时器显示格式为 `HH:MM:SS`
- [ ] 时间准确（对比系统时钟）
- [ ] 点击"暂停"按钮，计时器暂停
- [ ] 点击"启动"按钮，计时器继续计时（不重置）
- [ ] 点击"重置"按钮，计时器重置为 `00:00:00`

### 5.2 计时器按钮状态
- [ ] 初始状态：启动按钮启用，暂停和重置按钮禁用
- [ ] 运行时：启动按钮禁用，暂停启用，重置禁用
- [ ] 暂停时：启动启用，暂停禁用，重置启用
- [ ] 重置后：回到初始状态

### 5.3 计时器准确性
- [ ] 记录计时器显示的时间（如 `00:02:30`）
- [ ] 等待10秒左右
- [ ] 验证计时器增加了约10秒
- [ ] 重复以验证准确性

**关键：** 计时器应该每秒准确更新一次

---

## 6. 倒计时功能

### 6.1 倒计时显示
- [ ] 页面加载时显示倒计时（到下一个游戏季节更新）
- [ ] 倒计时显示格式正确（如 "距离下次更新还有 X 天 Y 小时"）
- [ ] 倒计时实时更新

### 6.2 倒计时动画
- [ ] 倒计时是否有视觉动画或动画效果
- [ ] 动画流畅，不影响其他功能

---

## 7. 本地排行榜功能

### 7.1 保存记录
- [ ] 运行计时器超过120秒（2分钟）
- [ ] 选择一个罪人和人格
- [ ] 点击"保存到本地"按钮
- [ ] 显示成功通知

**验证localStorage：**
```javascript
// 在浏览器控制台中
JSON.parse(localStorage.getItem('local_ranking'))  // 应该包含记录
```

### 7.2 排行榜显示
- [ ] 点击"查看排行榜"按钮，打开排行榜页面
- [ ] 排行榜显示本地保存的记录
- [ ] 记录按时间升序排列（快的排在前面）
- [ ] 显示罪人、人格和用时

### 7.3 多条记录
- [ ] 保存多条不同的记录
- [ ] 排行榜显示所有记录
- [ ] 记录正确排序

---

## 8. 全局排行榜集成（GitHub）

### 8.1 上传准备
- [ ] 运行计时器超过7200秒（2小时）
- [ ] 选择一个罪人和人格
- [ ] "上传全球榜"按钮应启用

### 8.2 上传流程
- [ ] 点击"上传全球榜"按钮
- [ ] 打开Modal显示上传表单
- [ ] 可以选择"通关记录"或"层数记录"
- [ ] 表单包含：罪人、人格、用时、E.G.O等字段

### 8.3 表单验证
- [ ] 尝试不填写必需字段，应显示错误
- [ ] 填写所有字段
- [ ] 点击"提交"按钮

**注意：** 实际的GitHub集成测试需要GitHub账号和网络连接

---

## 9. 页面导航

### 9.1 页面切换
- [ ] 点击"设置"按钮，进入设置页面
- [ ] 显示罪人筛选和人格设置
- [ ] 点击"返回"或"主页"按钮，回到主页面
- [ ] 页面正确切换，没有加载延迟

### 9.2 设置页面
- [ ] 设置页面显示所有罪人的复选框
- [ ] 每个罪人下显示其人格的复选框
- [ ] 复选框状态反映当前的筛选

### 9.3 排行榜页面
- [ ] 点击"排行榜"按钮，打开 `ranking.html`
- [ ] 排行榜页面加载成功
- [ ] 显示本地和全局排行榜标签
- [ ] 可以在两个标签间切换

---

## 10. Modal和通知

### 10.1 Alert Dialog
- [ ] 某些操作触发Alert（如验证失败）
- [ ] Modal显示标题、消息和"确定"按钮
- [ ] 点击"确定"关闭Modal
- [ ] 点击背景或ESC键关闭Modal（可选）

### 10.2 Confirm Dialog
- [ ] 某些操作触发Confirm（如返回设置页面时有未保存更改）
- [ ] Modal显示"取消"和"确定"按钮
- [ ] 点击"确定"执行操作
- [ ] 点击"取消"关闭Modal而不执行操作

### 10.3 通知消息
- [ ] 保存记录时显示成功通知
- [ ] 上传时显示适当的通知
- [ ] 错误发生时显示错误通知
- [ ] 通知在屏幕角落显示，自动消失

---

## 11. 帮助和关于

### 11.1 帮助Modal
- [ ] 点击"帮助"或"?"按钮
- [ ] 显示帮助Modal窗口
- [ ] 帮助内容清晰易读
- [ ] 点击"关闭"或背景关闭Modal

### 11.2 关于信息
- [ ] 检查页面是否显示应用版本信息
- [ ] 显示贡献者或作者信息（可选）

---

## 12. 响应式设计和可访问性

### 12.1 移动设备
- [ ] 在手机设备上打开应用（或使用浏览器开发者工具模拟）
- [ ] 应用布局正确响应（按钮、列表可用）
- [ ] 按钮大小适合点击（最小44x44px）
- [ ] 文本可读

### 12.2 无障碍
- [ ] 使用Tab键导航，所有可交互元素都能获得焦点
- [ ] 使用屏幕阅读器测试（如NVDA、JAWS）
- [ ] Modal有适当的ARIA标签
- [ ] 按钮和表单有清晰的标签

---

## 13. 边界情况

### 13.1 数据边界
- [ ] 选择单个罪人，无闪烁（highlightSelectedItem测试）
- [ ] 选择所有罪人
- [ ] 取消选择所有罪人（应禁用滚动按钮）
- [ ] 某个罪人没有人格（如果存在）

### 13.2 性能
- [ ] 滚动列表是否流畅（60FPS）
- [ ] 没有明显的延迟或卡顿
- [ ] 计时器更新流畅
- [ ] 页面导航响应迅速

### 13.3 网络
- [ ] 离线时应用仍然工作（除了上传到GitHub）
- [ ] 网络恢复后可以上传
- [ ] 网络错误有适当的错误处理

---

## 14. 浏览器兼容性

测试在以下浏览器上运行：

- [ ] Chrome 90+
- [ ] Firefox 88+
- [ ] Safari 14+
- [ ] Edge 90+

**验证：**
- 页面加载正常
- 所有功能正常工作
- 没有JavaScript错误
- 样式正确渲染

---

## 15. 代码质量

### 15.1 Console检查
- [ ] 打开浏览器开发者工具（F12）
- [ ] 查看Console标签
- [ ] 没有红色错误信息
- [ ] 没有黄色警告（除非预期的）

**常见良好消息：**
```
✓ 核心服务已初始化
✓ 所有Controller已初始化
✓ 应用已成功启动
```

### 15.2 性能
- [ ] 打开DevTools Performance标签
- [ ] 录制页面加载
- [ ] 首次内容绘制（FCP）< 2秒
- [ ] 最大内容绘制（LCP）< 4秒
- [ ] 没有长任务（> 50ms）

### 15.3 内存
- [ ] 运行应用10分钟
- [ ] 检查内存使用（DevTools Memory标签）
- [ ] 内存使用不应无限增长（无内存泄漏）

---

## 16. 回归测试清单

**最关键的测试 - 确保没有功能回归：**

### 必测项
- [ ] **单罪人边界情况** - highlightSelectedItem bug不回归
- [ ] **计时器准确性** - 时间计算正确
- [ ] **本地排行榜保存** - 数据正确保存
- [ ] **筛选保存** - localStorage持久化
- [ ] **页面导航** - 页面切换流畅
- [ ] **Dialog功能** - Alert/Confirm正常工作

### 可选测试（高级）
- [ ] **全局排行榜上传** - 需要GitHub连接
- [ ] **跨标签通信** - 两个标签页同时打开
- [ ] **离线功能** - 断网后的行为

---

## 测试结果摘要

### 总体通过率
```
通过: ___/___
失败: ___/___
跳过: ___/___
成功率: ___%
```

### 发现的问题

| # | 问题描述 | 严重程度 | 状态 |
|---|--------|--------|------|
| 1 | | | |
| 2 | | | |
| 3 | | | |

### 签名和日期

测试执行人: ________________  
日期: ________________  
浏览器: ________________  
环境: ________________  

---

## 测试环境设置

### Python服务器
```bash
cd /path/to/lam
python -m http.server 8000
# 访问 http://localhost:8000
```

### Node.js服务器
```bash
cd /path/to/lam
npx http-server -p 8000
# 访问 http://localhost:8000
```

### 开发者工具快捷键
- 打开DevTools: F12
- 打开Console: Ctrl+Shift+J
- 打开Network: Ctrl+Shift+K
- 打开Performance: Ctrl+Shift+E
- 打开Application: Ctrl+Shift+J 然后切换到Application标签

---

## 附录：调试命令

在浏览器Console中运行这些命令进行调试：

```javascript
// 查看应用状态
window.debugAppStateCompat();

// 查看事件日志
window.debugEventsCompat();

// 获取特定状态
window.appState.get('game.selectedSinner');
window.appState.get('timer.elapsedSeconds');

// 手动发出事件（用于测试）
window.eventBus.emit('SINNER_SELECTED', { sinner: { id: 1, name: '测试' } });

// 查看localStorage
localStorage;
```

---

**最后更新:** 2024年
**版本:** 1.5.0+
