# 排行榜数据管理指南

## 📋 目录

1. [概述](#概述)
2. [管理员操作指南](#管理员操作指南)
3. [普通用户操作指南](#普通用户操作指南)
4. [程序化接口说明](#程序化接口说明)
5. [常见问题解答](#常见问题解答)

---

## 概述

本系统采用 **GitHub Issues** 作为数据提交后端，通过 **GitHub Actions** 自动聚合数据到 JSON 文件。这种设计具有以下特点：

- ✅ 透明公开：所有提交记录在 GitHub Issues 中可见
- ✅ 版本可控：数据变更有完整的 Git 历史
- ✅ 无需服务器：利用 GitHub 免费基础设施
- ✅ 审核机制：管理员审核后数据才会生效

### 系统架构

```
用户提交 Issue → 管理员审核 → 添加"已审核"标签 → GitHub Actions 处理 → JSON 文件更新
```

---

## 管理员操作指南

### 1. 审核通关记录

**操作流程：**

1. 登录 GitHub，进入仓库的 Issues 页面
2. 筛选标签为 `通关记录` 或 `层数记录` 的 Issue
3. 查看 Issue 内容，验证数据是否合理：
   - 检查通关时间是否符合要求（≥2小时/7200秒）
   - 检查罪人和人格选择是否匹配
   - 检查是否有可疑的重复提交
4. 审核通过后，为 Issue 添加 `已审核` 标签
5. 系统会自动触发 GitHub Actions 更新排行榜数据

**审核标准：**

| 检查项 | 要求 |
|-------|------|
| 通关时间 | ≥ 7200秒（2小时） |
| 罪人ID | 1-12 之间 |
| 人格名称 | 与所选罪人匹配 |
| 通关日期 | 有效的日期格式 |
| 层数（如有） | 5、10 或 15 |

### 2. 删除/拒绝记录

**方法一：关闭 Issue（推荐）**

1. 打开需要拒绝的 Issue
2. 在评论中说明拒绝原因
3. 点击 "Close issue" 关闭
4. 被关闭的 Issue 不会被处理

**方法二：添加拒绝标签**

1. 创建一个 `已拒绝` 或 `无效` 标签
2. 为问题 Issue 添加该标签
3. 脚本只处理带有 `已审核` 标签的 Issue

**方法三：从 JSON 文件中删除（已处理的记录）**

如果错误记录已被处理并写入 JSON 文件：

1. Clone 仓库到本地
2. 编辑 `data/global-ranking.json` 或 `data/global-floor-ranking.json`
3. 删除对应的记录条目
4. 提交并推送更改：
   ```bash
   git add data/global-ranking.json data/global-floor-ranking.json
   git commit -m "fix: 删除无效排行榜记录 #<Issue编号>"
   git push
   ```

### 3. 手动触发数据更新

1. 进入仓库的 Actions 页面
2. 选择 "Update Global Ranking" 工作流
3. 点击 "Run workflow"
4. 等待工作流执行完成

### 4. 标签管理说明

| 标签名 | 用途 | 处理逻辑 |
|-------|------|---------|
| `通关记录` | 标识完整通关时间记录 | 用户提交时自动添加 |
| `层数记录` | 标识仅层数记录 | 用户提交时自动添加 |
| `待处理` | 等待管理员审核 | 用户提交时自动添加 |
| `已审核` | 管理员审核通过 | **触发数据聚合** |
| `已处理` | 数据已入库 | 脚本处理后自动添加 |

---

## 普通用户操作指南

### 提交记录

详见 [全球排行榜功能使用指南](../../GLOBAL_RANKING_GUIDE.md)

### 查看自己的提交状态

1. 登录 GitHub
2. 进入仓库 Issues 页面
3. 点击 "Created by you" 筛选您创建的 Issue
4. 查看 Issue 的标签状态：
   - `待处理`：等待管理员审核
   - `已审核`：审核通过，正在处理
   - `已处理`：已成功录入排行榜

### 修改已提交的记录

**当前状态：** ⚠️ 普通用户无法直接删除或修改已提交的记录

**修改方法：**

1. 在对应的 Issue 下添加评论，说明需要修改的内容和原因
2. 等待管理员处理
3. 或重新提交一个新的正确记录

**删除方法：**

1. 在对应的 Issue 下添加评论，说明删除原因
2. 请求管理员关闭该 Issue 或从数据中删除

### 未来功能规划

考虑在未来版本中添加以下功能：

- [ ] 用户自主删除（提交后24小时内可撤销）
- [ ] Issue 评论触发修改（通过特定命令格式）
- [ ] 用户个人页面管理自己的所有记录

---

## 程序化接口说明

### 当前状态

**本系统不提供公开的 API 接口用于直接操作排行榜数据。**

所有数据操作都通过以下方式进行：

1. **读取数据：** 直接获取 JSON 文件
   ```
   GET https://raw.githubusercontent.com/{owner}/{repo}/main/data/global-ranking.json
   GET https://raw.githubusercontent.com/{owner}/{repo}/main/data/global-floor-ranking.json
   ```

2. **提交数据：** 通过 GitHub Issue 表单
   - 完整记录：使用 `submit-clear-run.yml` 模板
   - 层数记录：使用 `submit-floor-only.yml` 模板

3. **数据处理：** GitHub Actions 自动化
   - 触发条件：Issue 被添加 `已审核` 标签
   - 处理脚本：`scripts/generate-global-ranking.mjs`

### 批量操作

如需批量操作（如批量导入历史数据），请：

1. Fork 仓库
2. 本地运行修改后的聚合脚本
3. 直接编辑 JSON 文件
4. 提交 Pull Request 请求合并

### 安全措施

- ✅ 数据提交需要 GitHub 账号
- ✅ 数据入库需要管理员审核
- ✅ 所有变更有 Git 历史记录
- ✅ Issue 内容公开透明可追溯
- ✅ 工作流使用受限的 GITHUB_TOKEN

---

## 常见问题解答

### Q1: 我提交的记录多久会出现在排行榜？

**A:** 管理员审核通过（添加"已审核"标签）后，约 3-5 分钟内更新。

### Q2: 我发现提交了错误的数据，怎么办？

**A:** 请在对应 Issue 下评论说明情况，管理员会进行处理。

### Q3: 为什么我的记录被拒绝了？

**A:** 可能的原因：
- 通关时间不足2小时
- 数据格式不正确
- 疑似虚假数据
- 重复提交

管理员会在 Issue 中说明拒绝原因。

### Q4: 管理员如何成为？

**A:** 管理员权限由仓库 Owner 授予。如有意愿参与管理，请联系仓库管理员。

### Q5: 数据是否会定期备份？

**A:** 是的，所有数据都通过 Git 版本控制，任何时间点的数据都可以恢复。

### Q6: 如何举报可疑记录？

**A:** 
1. 在对应 Issue 下评论举报
2. 或创建新 Issue 说明情况
3. 管理员会进行核实处理

---

## 联系方式

如有问题或建议，请通过以下方式联系：

- GitHub Issues：在仓库提交 Issue
- QQ群：313198040

---

*最后更新：2025-12-13*
