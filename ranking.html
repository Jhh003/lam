<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蛋筒时间排行榜 - Limbus Company</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/common.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-trophy"></i>蛋筒时间排行榜</h1>
        <div id="ranking-list" class="ranking-list">
            <!-- 排行榜记录将通过JavaScript动态添加 -->
        </div>
        <div class="actions">
            <button id="back-btn" class="btn-primary"><i class="fas fa-arrow-left"></i> 返回主页</button>
            <button id="clear-btn" class="btn-danger"><i class="fas fa-trash"></i> 清空记录</button>
        </div>
    </div>

    <script>
        // 格式化时间（秒 -> HH:MM:SS）
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const remainingSeconds = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // 加载排行榜
        function loadRanking() {
            const rankingList = document.getElementById('ranking-list');
            const records = JSON.parse(localStorage.getItem('personalRanking') || '[]');
            
            if (records.length === 0) {
                rankingList.innerHTML = '<div class="no-records">暂无记录</div>';
                return;
            }
            
            // 按时间升序排序
            records.sort((a, b) => a.time - b.time);
            
            rankingList.innerHTML = records.map((record, index) => `
                <div class="ranking-item">
                    <div class="ranking-number">${index + 1}</div>
                    ${record.sinner || record.persona ? `
                        <div class="character-info">
                            <img src="${record.persona ? record.persona.avatar : record.sinner.avatar}" alt="${record.persona ? record.persona.name : record.sinner.name}" class="character-avatar">
                            <div class="character-details">
                                ${record.persona ? `<div class="character-name">${record.persona.name}</div>` : `<div class="character-name">${record.sinner.name}</div>`}
                                ${record.sinner && record.persona ? `<div class="personality-name">${record.persona.name}</div>` : ''}
                            </div>
                        </div>
                    ` : ''}
                    <div class="ranking-info">
                        <div class="ranking-date">${new Date(record.timestamp).toLocaleString()}</div>
                        <div class="ranking-comment">${record.comment || '无备注'}</div>
                    </div>
                    <div class="ranking-time">${formatTime(record.time)}</div>
                </div>
            `).join('');
        }
        
        // 清空所有记录
        function clearAllRecords() {
            if (confirm('确定要清空所有排行榜记录吗？此操作不可恢复。')) {
                localStorage.removeItem('personalRanking');
                loadRanking();
            }
        }
        
        // 返回主页
        function goToHomePage() {
            window.location.href = 'index.html';
        }
        
        // 页面加载时加载排行榜并添加事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            loadRanking();
            
            // 添加按钮事件监听器
            document.getElementById('back-btn').addEventListener('click', goToHomePage);
            document.getElementById('clear-btn').addEventListener('click', clearAllRecords);
        });
    </script>
</body>
</html>