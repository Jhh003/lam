# 版本 1.5.0 - 上传功能重构说明文档

## 📋 功能概览

本次更新（v1.5.0）对全球排行榜上传功能进行了全面重构，提供了更清晰、更灵活的上传方式。

---

## 🎯 核心改进

### 1. 界面结构优化

#### 计时器弹窗简化
**之前（v1.4.0）：**
- 计时器弹窗内包含大量表单字段
- 混杂备注、E.G.O 复选框、单通层数等选项
- 界面拥挤，用户体验不佳

**现在（v1.5.0）：**
- 计时器弹窗只保留核心功能
- 仅包含：备注输入框、三个功能按钮
- 界面清爽，操作直观

#### 独立上传模态窗口
**新增特性：**
- 点击"上传全球榜"按钮后打开独立窗口
- 专门的上传表单设计
- 清晰的视觉层次
- 支持点击背景关闭

---

## 📝 两种上传类型

### 类型 1：完整记录上传

**适用场景：**
- 想要同时记录通关时间和单通层数
- 追求完整的通关数据记录

**必填信息：**
- ✅ 通关时间：自动读取当前计时器时间
- ✅ 单通层数：必须选择（第5层/第10层/第15层）

**可选信息：**
- 🔘 是否使用 E.G.O
- 📝 备注说明（最多100字）

**限制条件：**
- ⏰ 通关时间必须 ≥ 2小时（7200秒）
- 📍 必须选择单通层数

**排行榜展示：**
- 📊 时间排行榜（都市广播）
- 📊 层数排行榜（单通层数）

---

### 类型 2：简化记录上传

**适用场景：**
- 只想记录单通层数成就
- 不关心通关时间统计
- 快速提交记录

**必填信息：**
- ✅ 单通层数：必须选择（第5层/第10层/第15层）

**可选信息：**
- 📝 备注说明（最多100字）

**限制条件：**
- ⏰ **无时间限制**，随时可以上传
- 📍 必须选择单通层数

**排行榜展示：**
- 📊 层数排行榜（单通层数）

---

## 🎨 UI/UX 设计

### 上传类型选择器

**卡片式设计：**
```
┌─────────────────────┐  ┌─────────────────────┐
│  📋 完整记录上传    │  │  📊 简化记录上传    │
│                     │  │                     │
│ 同时记录单通时间   │  │ 仅记录单通层数，    │
│ 和单通层数         │  │ 不包含时间          │
└─────────────────────┘  └─────────────────────┘
```

**交互效果：**
- 未选中：灰色边框，半透明背景
- 选中：金色边框，高亮背景，轻微放大

### 表单分区设计

#### 完整记录上传表单

```
┌─────────────────────────────────┐
│ ⏰ 时间信息                      │
│   通关时间：02:15:30 (只读)     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 📊 层数信息                      │
│   选择单通层数：                 │
│   [第5层] [第10层] [第15层]     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ℹ️ 附加信息                      │
│   ☑ 使用了 E.G.O                │
│   备注：[文本框]                 │
└─────────────────────────────────┘
```

#### 简化记录上传表单

```
┌─────────────────────────────────┐
│ 📊 层数信息                      │
│   选择单通层数：                 │
│   [第5层] [第10层] [第15层]     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ℹ️ 附加信息                      │
│   备注：[文本框]                 │
└─────────────────────────────────┘
```

### 层数选择按钮

**样式特点：**
- 三个按钮水平排列
- 未选中：深色背景，浅色边框
- 选中：金色边框，金色文字，发光效果
- 悬停：边框变金色，背景微亮

---

## 🔄 操作流程

### 完整记录上传流程

1. **打开上传窗口**
   - 点击计时器弹窗中的"上传全球榜"按钮
   - 系统检查是否已选择罪人和人格

2. **选择上传类型**
   - 默认选中"完整记录上传"
   - 如需更改，点击"简化记录上传"卡片

3. **填写表单**
   - 查看自动填充的通关时间
   - 选择单通层数（必选）
   - 勾选 E.G.O 使用情况（可选）
   - 填写备注（可选）

4. **提交确认**
   - 点击"确认上传"按钮
   - 查看确认信息弹窗
   - 确认后跳转到 GitHub Issue 页面

5. **完成提交**
   - 在 GitHub 页面填写表单
   - 提交 Issue
   - 等待管理员审核

### 简化记录上传流程

1. **打开上传窗口**
   - 点击计时器弹窗中的"上传全球榜"按钮
   - 系统检查是否已选择罪人和人格

2. **选择上传类型**
   - 点击"简化记录上传"卡片
   - 表单自动切换为简化模式

3. **填写表单**
   - 选择单通层数（必选）
   - 填写备注（可选）

4. **提交确认**
   - 点击"确认上传"按钮
   - 查看确认信息弹窗（注明仅显示在层数排行榜）
   - 确认后跳转到 GitHub Issue 页面

5. **完成提交**
   - 在 GitHub 页面填写表单
   - 提交 Issue（自动打上"层数记录"标签）
   - 等待管理员审核

---

## 🛠️ 技术实现

### 新增文件

1. **`submit-floor-only.yml`**
   - 位置：`.github/ISSUE_TEMPLATE/`
   - 用途：简化记录提交的 GitHub Issue 模板
   - 标签：自动打上"层数记录"标签

### 修改文件

1. **`index.html`**
   - 简化计时器弹窗表单（删除29行）
   - 新增上传模态窗口（新增126行）
   - 更新版本号为 1.5.0

2. **`css/common.css`**
   - 新增上传模态窗口样式（新增217行）
   - 包含：类型选择器、表单分区、层数按钮、响应式设计

3. **`js/common.js`**
   - 重构 `uploadToGlobalRanking` 函数
   - 新增 `showUploadModal`、`hideUploadModal` 函数
   - 新增 `handleUploadTypeChange` 函数
   - 新增 `submitFullRecord`、`submitFloorOnlyRecord` 函数
   - 新增上传模态窗口事件监听

4. **`README.md`**
   - 新增 v1.5.0 版本更新日志
   - 详细说明新功能和改进

### 核心函数

#### `uploadToGlobalRanking()`
```javascript
// 功能：打开上传模态窗口
// 验证：检查是否已选择罪人和人格
// 操作：显示上传窗口，填充时间信息
```

#### `showUploadModal()`
```javascript
// 功能：显示上传模态窗口
// 操作：
// - 填充当前通关时间
// - 重置表单
// - 默认选中完整记录上传
// - 显示窗口，禁止背景滚动
```

#### `hideUploadModal()`
```javascript
// 功能：隐藏上传模态窗口
// 操作：关闭窗口，恢复背景滚动
```

#### `handleUploadTypeChange()`
```javascript
// 功能：处理上传类型切换
// 操作：根据选中类型显示/隐藏对应表单
```

#### `submitFullRecord()`
```javascript
// 功能：提交完整记录
// 验证：
// - 通关时间 ≥ 7200秒
// - 必须选择层数
// 操作：生成 GitHub Issue URL 并打开
```

#### `submitFloorOnlyRecord()`
```javascript
// 功能：提交简化记录
// 验证：
// - 必须选择层数
// 操作：生成 GitHub Issue URL 并打开
```

---

## 📊 数据流程

### 完整记录数据流

```
用户填写表单
    ↓
选择：完整记录上传
    ↓
验证：时间 ≥ 7200秒
    ↓
验证：层数已选择
    ↓
生成确认信息
    ↓
用户确认
    ↓
打开 GitHub Issue（submit-clear-run.yml）
    ↓
用户提交 Issue
    ↓
GitHub Actions 处理
    ↓
数据写入两个排行榜：
- global-ranking.json（时间榜）
- global-floor-ranking.json（层数榜）
```

### 简化记录数据流

```
用户填写表单
    ↓
选择：简化记录上传
    ↓
验证：层数已选择
    ↓
生成确认信息（注明仅层数榜）
    ↓
用户确认
    ↓
打开 GitHub Issue（submit-floor-only.yml）
    ↓
用户提交 Issue
    ↓
GitHub Actions 处理
    ↓
数据写入层数排行榜：
- global-floor-ranking.json（层数榜）
```

---

## 🎯 用户体验优化点

### 1. 清晰的功能分离
- ✅ 计时器功能和上传功能分离
- ✅ 不同上传类型清晰区分
- ✅ 视觉层次明确

### 2. 灵活的上传选择
- ✅ 完整记录：适合追求完整数据的玩家
- ✅ 简化记录：适合快速分享成就的玩家

### 3. 友好的交互设计
- ✅ 卡片式类型选择，点击高亮
- ✅ 表单分区，信息组织清晰
- ✅ 层数按钮美化，选中效果明显
- ✅ 点击背景关闭窗口

### 4. 完善的验证提示
- ✅ 未选择罪人/人格：友好提示
- ✅ 时间不足（完整记录）：明确说明要求
- ✅ 未选择层数：提示必选

### 5. 响应式设计
- ✅ 支持桌面和移动设备
- ✅ 移动端自动调整布局
- ✅ 按钮自适应宽度

---

## 📱 响应式设计

### 桌面端（>600px）
- 上传类型卡片：两列排列
- 层数按钮：水平排列
- 操作按钮：水平排列

### 移动端（≤600px）
- 上传类型卡片：单列排列
- 层数按钮：垂直排列
- 操作按钮：垂直排列，全宽显示

---

## 🚀 部署说明

### 需要更新的文件（共5个）

1. ✅ `index.html` - 新增上传模态窗口
2. ✅ `css/common.css` - 新增样式
3. ✅ `js/common.js` - 重构上传逻辑
4. ✅ `.github/ISSUE_TEMPLATE/submit-floor-only.yml` - 新建
5. ✅ `README.md` - 更新日志

### GitHub 配置

**确保以下标签存在：**
- ✅ `通关记录` - 用于完整记录
- ✅ `层数记录` - 用于简化记录（新增）
- ✅ `已处理` - 用于标记已处理的 Issue

**配置步骤：**
1. 进入 GitHub 仓库设置
2. 点击 Issues → Labels
3. 创建"层数记录"标签（颜色：#FFA500）

---

## ✅ 测试清单

### 功能测试

- [ ] 点击"上传全球榜"按钮打开上传窗口
- [ ] 上传窗口显示当前通关时间
- [ ] 切换上传类型，表单正确切换
- [ ] 完整记录：时间 < 7200秒时提示错误
- [ ] 完整记录：未选择层数时提示错误
- [ ] 简化记录：未选择层数时提示错误
- [ ] 确认上传后正确跳转到 GitHub
- [ ] GitHub Issue 使用正确的模板
- [ ] 点击背景关闭上传窗口
- [ ] 点击关闭按钮关闭上传窗口
- [ ] 点击取消按钮关闭上传窗口

### 样式测试

- [ ] 上传类型卡片选中效果正确
- [ ] 层数按钮选中效果正确
- [ ] 表单分区样式统一
- [ ] 响应式布局在移动端正常
- [ ] 所有按钮文字居中
- [ ] 颜色符合边狱巴士风格

### 兼容性测试

- [ ] Chrome 浏览器正常
- [ ] Firefox 浏览器正常
- [ ] Edge 浏览器正常
- [ ] 移动端 Safari 正常
- [ ] 移动端 Chrome 正常

---

## 📝 总结

v1.5.0 通过界面重构和功能优化，为用户提供了：

✅ **更清晰的界面**：计时器和上传功能分离  
✅ **更灵活的选择**：两种上传类型满足不同需求  
✅ **更友好的交互**：卡片式设计，操作直观  
✅ **更完善的验证**：明确的错误提示  
✅ **更好的兼容**：响应式设计支持多设备  

这次更新显著提升了用户体验，使上传功能更加专业和易用！
