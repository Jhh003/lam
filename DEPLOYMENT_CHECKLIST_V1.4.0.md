# v1.4.0 部署清单

## ✅ 修改的文件（共6个）

### 前端文件（3个）

1. ✅ **`index.html`**
   - 新增"是否成功单通？"复选框（第181-186行）
   - 新增层数选择单选按钮组（第187-203行）
   - 版本号更新为 1.4.0（第17行）

2. ✅ **`js/common.js`**
   - 新增层数选择元素引用（第138-139行）
   - 新增层数数据收集逻辑（第269-275行）
   - 新增确认弹窗层数信息显示（第306-308行）
   - 新增首次使用指南（第445-458行）

3. ✅ **`ranking.html`**
   - 新增"单通层数（联网）"标签页（第212-214行）
   - 新增层数排行榜内容区域（第244-258行）
   - 新增 `loadFloorRanking()` 函数（第424-508行）
   - 更新标签页切换逻辑（第513-531行）

### GitHub 配置文件（2个）

4. ✅ **`.github/ISSUE_TEMPLATE/submit-clear-run.yml`**
   - 新增"是否成功单通"复选框字段（第64-71行）
   - 新增"单通层数"下拉选择字段（第73-84行）

5. ✅ **`scripts/generate-global-ranking.mjs`**
   - 解析成功单通字段（第78-80行）
   - 解析层数字段（第81-88行）
   - 新增层数排行榜数据结构（第150-175行）
   - 初始化层数排行榜罪人数据（第186-193行）
   - 添加层数记录到数据结构（第245-268行）
   - 层数排行榜排序逻辑（第284-302行）
   - 写入层数排行榜文件（第306-307行）

### 文档文件（1个）

6. ✅ **`README.md`**
   - 新增 v1.4.0 版本更新日志（第82-105行）

---

## 📁 新增的文件（共2个）

7. ✅ **`data/global-floor-ranking.json`**
   - 层数排行榜初始数据文件（68行）

8. ✅ **`FLOOR_RANKING_FEATURE.md`**
   - 完整的功能说明文档（616行）

---

## 🔍 代码验证

✅ 所有文件已通过语法检查  
✅ 无编译错误  
✅ 无语法错误  

---

## 🚀 快速部署步骤

### 步骤1：提交代码

```bash
git add .
git commit -m "feat: v1.4.0 - 新增成功单通层数排行榜功能"
git push origin main
```

### 步骤2：手动触发 Actions（可选）

1. 访问：`https://github.com/Jhh003/lam/actions`
2. 选择 "Update Global Ranking"
3. 点击 "Run workflow" → "Run workflow"
4. 等待完成（约30秒）

### 步骤3：验证部署

**前端测试：**
- [ ] 访问主页，版本号显示为 1.4.0
- [ ] 打开计时器弹窗，能看到"是否成功单通？"复选框
- [ ] 勾选复选框后显示层数选择
- [ ] 首次勾选时弹出使用说明

**排行榜测试：**
- [ ] 访问 `ranking.html`
- [ ] 能看到三个标签页（本地、联网、层数）
- [ ] 点击"单通层数（联网）"标签页正常切换
- [ ] 显示"暂无记录"或正确的排行榜数据

**GitHub 测试：**
- [ ] 创建新 Issue，选择"提交通关记录"模板
- [ ] 表单中有"是否成功单通"复选框
- [ ] 表单中有"单通层数"下拉菜单
- [ ] 提交后 Actions 自动运行
- [ ] 生成两个数据文件（时间 + 层数）

---

## ⚙️ GitHub 配置检查

### 必须配置项：

1. **修改仓库信息**（如果还没改）
   - 文件：`js/common.js` 第270-271行
   - 修改 `repoOwner` 和 `repoName`

2. **创建标签**
   - 前往：Settings → Issues → Labels
   - 创建两个标签：
     - `通关记录` (蓝色 #0366d6)
     - `已处理` (绿色 #28a745)

3. **配置 Actions 权限**
   - 前往：Settings → Actions → General
   - Workflow permissions 选择 "Read and write permissions"
   - 点击 Save

---

## 📊 功能特性

### 核心功能

✅ 成功单通层数上传  
✅ 独立的层数排行榜展示  
✅ 智能排序（层数优先 + 时间次之）  
✅ 首次使用自动引导  
✅ 边狱巴士风格UI  
✅ 响应式布局  

### 数据结构

**时间排行榜**：`data/global-ranking.json`  
- 按通关时间排序（快→慢）
- 每个人格最多保留50条记录

**层数排行榜**：`data/global-floor-ranking.json`  
- 按层数排序（15层 > 10层 > 5层）
- 相同层数按提交时间排序（早→晚）
- 每个人格最多保留50条记录

### 支持的层数

- 第5层
- 第10层
- 第15层

---

## 💡 使用指南

### 用户上传流程

1. 完成罪人和人格抽取
2. 开始游戏计时
3. 完成游戏后停止计时
4. 在表单中：
   - 填写备注（可选）
   - 勾选"是否使用了 E.G.O"（可选）
   - **勾选"是否成功单通？"**
   - **选择单通层数（5/10/15）**
5. 点击"上传全球榜"
6. 在 GitHub Issue 页面提交

### 首次使用说明

首次勾选"是否成功单通？"时，会自动弹出使用说明：

```
🎯 成功单通层数上传指南

1、选中"是否成功单通？"后，需要选择您成功单通的最高层数。

2、目前支持的层数有：第5层、第10层、第15层。

3、层数排行榜按层数高低排序（15层 > 10层 > 5层）。

4、相同层数的记录按提交时间排序，先提交的排在前面。

5、您可以在排行榜页面的"单通层数（联网）"标签页查看所有层数记录。
```

---

## 🐛 常见问题

### Q1：层数排行榜显示"暂无记录"？

**原因**：还没有人提交层数记录，或 Actions 还未运行。

**解决**：
1. 提交一条测试记录（勾选成功单通并选择层数）
2. 等待 Actions 自动运行（约1分钟）
3. 刷新排行榜页面

### Q2：首次使用说明不显示？

**原因**：已经显示过一次，localStorage 中有记录。

**解决**：打开浏览器控制台执行：
```javascript
localStorage.removeItem('hasSeenFloorGuide');
```
然后重新勾选复选框。

### Q3：同时提交时间和层数会怎样？

**答**：两个排行榜是独立的，同一条记录可以同时出现在两个榜单中。

---

## 📈 版本对比

| 项目 | v1.3.1 | v1.4.0 |
|------|--------|--------|
| 时间排行榜 | ✅ | ✅ |
| 层数排行榜 | ❌ | ✅ |
| 标签页数量 | 2个 | 3个 |
| Issue 表单字段 | 7个 | 9个 |
| 数据文件 | 1个 | 2个 |
| 首次使用指南 | ❌ | ✅ |

---

## 📞 支持

如遇到问题，请：
1. 查看 [FLOOR_RANKING_FEATURE.md](file:///e:/lam/FLOOR_RANKING_FEATURE.md) 完整文档
2. 检查 GitHub Actions 日志
3. 查看浏览器控制台错误
4. 在 GitHub Issues 提问

---

**部署完成后记得测试所有功能！** 🎉
